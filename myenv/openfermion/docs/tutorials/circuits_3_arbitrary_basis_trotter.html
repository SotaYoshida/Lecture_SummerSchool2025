
<!DOCTYPE html>


<html lang="ja" data-content_root="../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Copyright 2020 The OpenFermion Developers &#8212; Julia言語による原子核構造計算入門</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../../../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../../../_static/documentation_options.js?v=1cf7f4d9"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script src="../../../../_static/translations.js?v=91613774"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'myenv/openfermion/docs/tutorials/circuits_3_arbitrary_basis_trotter';</script>
    <link rel="index" title="索引" href="../../../../genindex.html" />
    <link rel="search" title="検索" href="../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="ja"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">本文へスキップ</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>トップに戻る</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="バージョン警告"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../../home.html">
  
  
  
  
  
  
    <p class="title logo__title">Julia言語による原子核構造計算入門</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="検索" aria-label="検索" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">検索</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../home.html">
                    講義の狙いと資料の概要
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">pairing Hamiltonianと多体計算手法</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/Hamiltonian.html">1. pairing Hamiltonian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/FullCI.html">2. Full-CI/厳密対角化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/HartreeFock.html">3. Hartree-Fock</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/BCS.html">4. BCS (Bardeen-Cooper-Schrieffer)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/MBPT.html">5. Many-Body Perturbation Theory (MBPT)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/CoupledCluster.html">6. Coupled Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/IMSRG.html">7. In-medium Similarity Renormalization Group (IM-SRG)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/EC.html">8. Emulator/Surrogate model</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">量子計算</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/QuantumComputing.html">9. Quantum Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/Pairing_VQE_pennylane.html">10. Pairing HamiltonianのVQE計算 (Pennylane)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/qpe_pennylane.html">11. Pairing HamiltonianのQPE計算 (Pennylane)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../notebooks/Pairing_VQE_pytket.html">12. Pairing Hamiltonianの量子計算 (pytket)</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/SotaYoshida/Lecture_SummerSchool2025" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="ソースリポジトリ"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/SotaYoshida/Lecture_SummerSchool2025/issues/new?title=Issue%20on%20page%20%2Fmyenv/openfermion/docs/tutorials/circuits_3_arbitrary_basis_trotter.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="問題を報告"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="このページをダウンロード">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../_sources/myenv/openfermion/docs/tutorials/circuits_3_arbitrary_basis_trotter.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="ソースファイルをダウンロード"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="PDFに印刷"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="全画面モード"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="ライト"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="ダーク"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="検索" aria-label="検索" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Copyright 2020 The OpenFermion Developers</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> 目次 </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Copyright 2020 The OpenFermion Developers</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#circuits-3-low-rank-arbitrary-basis-molecular-simulations">Circuits 3: Low rank, arbitrary basis molecular simulations</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#low-rank-decomposition-of-the-coulomb-operator">Low rank decomposition of the Coulomb operator</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-implementation-trotter-steps-of-lih-in-molecular-orbital-basis">Example implementation: Trotter steps of LiH in molecular orbital basis</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="copyright-2020-the-openfermion-developers">
<h1>Copyright 2020 The OpenFermion Developers<a class="headerlink" href="#copyright-2020-the-openfermion-developers" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@title Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1"># https://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="circuits-3-low-rank-arbitrary-basis-molecular-simulations">
<h1>Circuits 3: Low rank, arbitrary basis molecular simulations<a class="headerlink" href="#circuits-3-low-rank-arbitrary-basis-molecular-simulations" title="Link to this heading">#</a></h1>
<table class="tfo-notebook-buttons" align="left">
  <td>
    <a target="_blank" href="https://quantumai.google/openfermion/tutorials/circuits_3_arbitrary_basis_trotter"><img src="https://quantumai.google/site-assets/images/buttons/quantumai_logo_1x.png" />View on QuantumAI</a>
  </td>
  <td>
    <a target="_blank" href="https://colab.research.google.com/github/quantumlib/OpenFermion/blob/master/docs/tutorials/circuits_3_arbitrary_basis_trotter.ipynb"><img src="https://quantumai.google/site-assets/images/buttons/colab_logo_1x.png" />Run in Google Colab</a>
  </td>
  <td>
    <a target="_blank" href="https://github.com/quantumlib/OpenFermion/blob/master/docs/tutorials/circuits_3_arbitrary_basis_trotter.ipynb"><img src="https://quantumai.google/site-assets/images/buttons/github_logo_1x.png" />View source on GitHub</a>
  </td>
  <td>
    <a href="https://storage.googleapis.com/tensorflow_docs/OpenFermion/docs/tutorials/circuits_3_arbitrary_basis_trotter.ipynb"><img src="https://quantumai.google/site-assets/images/buttons/download_icon_1x.png" />Download notebook</a>
  </td>
</table><section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading">#</a></h2>
<p>Install the OpenFermion package:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">openfermion</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/quantumlib/OpenFermion.git@master#egg<span class="o">=</span>openfermion
</pre></div>
</div>
</div>
</div>
</section>
<section id="low-rank-decomposition-of-the-coulomb-operator">
<h2>Low rank decomposition of the Coulomb operator<a class="headerlink" href="#low-rank-decomposition-of-the-coulomb-operator" title="Link to this heading">#</a></h2>
<p>The algorithm discussed in this tutorial is described in <a class="reference external" href="https://arxiv.org/abs/1808.02625">arXiv:1808.02625</a>.</p>
<p>In <a class="reference internal" href="circuits_1_basis_change.html"><span class="std std-doc">Circuits 1</span></a> we discussed methods for very compiling single-particle basis transformations of fermionic operators in <span class="math notranslate nohighlight">\(O(N)\)</span> depth on a linearly connected architecture. We looked at the particular example of simulating a free fermion model by using Bogoliubov transformations to diagonalize the model.</p>
<p>In <a class="reference internal" href="circuits_2_diagonal_coulomb_trotter.html"><span class="std std-doc">Circuits 2</span></a> we discussed methods for compiling Trotter steps of electronic structure Hamiltonian in <span class="math notranslate nohighlight">\(O(N)\)</span> depth on a linearly connected architecture when expressed in a basis diagonalizing the Coulomb operator so that
$<span class="math notranslate nohighlight">\(
H = \sum_{pq} T_{pq} a^\dagger_p a_q + \sum_{pq} V_{pq} a^\dagger_p a_p a^\dagger_q a_q.
\)</span>$</p>
<p>Here we will discuss how both of those techniques can be combined, along with some insights from electronic structure, in order to simulate arbitrary basis molecular Hamiltonians taking the form
$<span class="math notranslate nohighlight">\(
H = \sum_{pq} T_{pq} a^\dagger_p a_q + \sum_{pqrs} V_{pqrs} a^\dagger_p a_q a^\dagger_r a_s
\)</span><span class="math notranslate nohighlight">\(
in depth scaling only as \)</span>O(N^2)$ on a linear array of qubits. First, we note that the one-body part of the above expression is easy to simulate using the techniques introduced in <a class="reference internal" href="circuits_1_basis_change.html"><span class="std std-doc">Circuits 1</span></a>. Thus, the real challenge is to simulate the two-body part of the operator.</p>
<p>We begin with the observation that the rank-4 tensor <span class="math notranslate nohighlight">\(V\)</span>, with the values <span class="math notranslate nohighlight">\(V_{pqrs}\)</span> representing the coefficient of <span class="math notranslate nohighlight">\(a^\dagger_p a_q a^\dagger_r a_s\)</span> can be flattened into an <span class="math notranslate nohighlight">\(N^2 \times N^2\)</span> array by making <span class="math notranslate nohighlight">\(p,q\)</span> one index and <span class="math notranslate nohighlight">\(r,s\)</span> the other. This is the electronic repulsion integral (ERI) matrix in chemist notation. We will refer to the ERI matrix as <span class="math notranslate nohighlight">\(W\)</span>. By diagonalizing <span class="math notranslate nohighlight">\(W\)</span>, one obtains <span class="math notranslate nohighlight">\(W g_\ell = \lambda_\ell g_\ell\)</span> where the eigenvector <span class="math notranslate nohighlight">\(g_\ell\)</span> is a vector of dimension <span class="math notranslate nohighlight">\(N^2\)</span>. If we reshape <span class="math notranslate nohighlight">\(g_\ell\)</span> into an <span class="math notranslate nohighlight">\(N \times N\)</span> vector, we realize that
$<span class="math notranslate nohighlight">\(
\sum_{pqrs} V_{pqrs} a^\dagger_p a_q a^\dagger_r a_s = \sum_{\ell=0}^{L-1} \lambda_\ell \left(\sum_{pq} \left[g_{\ell}\right]_{pq} a^\dagger_p a_q\right)^2.
\)</span><span class="math notranslate nohighlight">\(
This is related to the concept of density fitting in electronic structure, which is often accomplished using a Cholesky decomposition. It is fairly well known in the quantum chemistry community that the ERI matrix is positive semi-definite and despite having linear dimension \)</span>N^2<span class="math notranslate nohighlight">\(, has rank of only \)</span>L = O(N)<span class="math notranslate nohighlight">\(. Thus, the eigenvalues \)</span>\lambda_\ell<span class="math notranslate nohighlight">\( are positive and there are only \)</span>O(N)$ of them.</p>
<p>Next, we diagonalize the one-body operators inside of the square so that
$<span class="math notranslate nohighlight">\(
R_\ell \left(\sum_{pq} \left[g_\ell\right]_{pq} a^\dagger_p a_q\right) R_\ell^\dagger = \sum_{p} f_{\ell p} a^\dagger_p a_p
\)</span><span class="math notranslate nohighlight">\(
where the \)</span>R_\ell<span class="math notranslate nohighlight">\( represent single-particle basis transformations of the sort we compiled in [Circuits 1](./circuits_1_basis_change.ipynb). Then,
\)</span><span class="math notranslate nohighlight">\(
\sum_{\ell=0}^{L-1} \lambda_\ell \left(\sum_{pq} \left[g_{\ell}\right]_{pq} a^\dagger_p a_q\right)^2 =
\sum_{\ell=0}^{L-1} \lambda_\ell \left(R_\ell \left(\sum_{p} f_{\ell p} a^\dagger_p a_p\right) R_\ell^\dagger\right)^2 = \sum_{\ell=0}^{L-1} \lambda_\ell \left(R_\ell \left(\sum_{p} f_{\ell p} a^\dagger_p a_p\right) R_\ell^\dagger R_\ell \left(\sum_{p} f_{\ell p} a^\dagger_p a_p\right) R_\ell^\dagger\right)
= \sum_{\ell=0}^{L-1} \lambda_\ell R_\ell \left(\sum_{pq} f_{\ell p} f_{\ell q} a^\dagger_p a_p a^\dagger_q a_q\right) R_\ell^\dagger.
\)</span><span class="math notranslate nohighlight">\(
We now see that we can simulate a Trotter step under the arbitrary basis two-body operator as
\)</span><span class="math notranslate nohighlight">\(
\prod_{\ell=0}^{L-1} R_\ell \exp\left(-i\sum_{pq} f_{\ell p} f_{\ell q} a^\dagger_p a_p a^\dagger_q a_q\right) R_\ell^\dagger
\)</span><span class="math notranslate nohighlight">\(
where we note that the operator in the exponential take the form of a diagonal Coulomb operator. Since we can implement the \)</span>R_\ell<span class="math notranslate nohighlight">\( circuits in \)</span>O(N)<span class="math notranslate nohighlight">\( depth (see [Circuits 1](./circuits_1_basis_change.ipynb)) and we can implement Trotter steps under diagonal Coulomb operators in \)</span>O(N)<span class="math notranslate nohighlight">\( layers of gates (see [Circuits 2](./circuits_2_diagonal_coulomb_trotter.ipynb)) we see that we can implement Trotter steps under arbitrary basis electronic structure Hamiltionians in \)</span>O(L N) = O(N^2)<span class="math notranslate nohighlight">\( depth, and all on a linearly connected device. This is a big improvement over the usual way of doing things, which would lead to no less than \)</span>O(N^5)$ depth! In fact, it is also possible to do better by truncating rank on the second diagonalization but we have not implemented that (details will be discussed in aforementioned paper-in-preparation).</p>
<p>Note that these techniques are also applicable to realizing evolution under other two-body operators, such as the generator of unitary coupled cluster. Note that one can create variational algorithms where a variational parameter specifies the rank at which to truncate the <span class="math notranslate nohighlight">\(\lambda_\ell\)</span>.</p>
</section>
<section id="example-implementation-trotter-steps-of-lih-in-molecular-orbital-basis">
<h2>Example implementation: Trotter steps of LiH in molecular orbital basis<a class="headerlink" href="#example-implementation-trotter-steps-of-lih-in-molecular-orbital-basis" title="Link to this heading">#</a></h2>
<p>We will now use these techniques to implement Trotter steps for an actual molecule. We will focus on LiH at equilibrium geometry, since integrals for that system are provided with every OpenFermion installation. However, by installing <a class="reference external" href="https://github.com/quantumlib/OpenFermion-PySCF">OpenFermion-PySCF</a> or <a class="reference external" href="https://github.com/quantumlib/OpenFermion-Psi4">OpenFermion-Psi4</a> one can use these techniques for any molecule at any geometry. We will generate LiH in an active space consisting of 4 qubits. First, we obtain the Hamiltonian as an InteractionOperator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openfermion</span>

<span class="c1"># Set Hamiltonian parameters for LiH simulation in active space.</span>
<span class="n">diatomic_bond_length</span> <span class="o">=</span> <span class="mf">1.45</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Li&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)),</span> <span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">diatomic_bond_length</span><span class="p">))]</span>
<span class="n">basis</span> <span class="o">=</span> <span class="s1">&#39;sto-3g&#39;</span>
<span class="n">multiplicity</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">active_space_start</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">active_space_stop</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Generate and populate instance of MolecularData.</span>
<span class="n">molecule</span> <span class="o">=</span> <span class="n">openfermion</span><span class="o">.</span><span class="n">MolecularData</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">basis</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;1.45&quot;</span><span class="p">)</span>
<span class="n">molecule</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

<span class="c1"># Get the Hamiltonian in an active space.</span>
<span class="n">molecular_hamiltonian</span> <span class="o">=</span> <span class="n">molecule</span><span class="o">.</span><span class="n">get_molecular_hamiltonian</span><span class="p">(</span>
    <span class="n">occupied_indices</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">active_space_start</span><span class="p">),</span>
    <span class="n">active_indices</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">active_space_start</span><span class="p">,</span> <span class="n">active_space_stop</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">openfermion</span><span class="o">.</span><span class="n">get_fermion_operator</span><span class="p">(</span><span class="n">molecular_hamiltonian</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We see from the above output that this is a fairly complex Hamiltonian already. Next we will use the <code class="docutils literal notranslate"><span class="pre">simulate_trotter</span></code> function from <a class="reference internal" href="circuits_1_basis_change.html"><span class="std std-doc">Circuits 1</span></a>, but this time using a different type of Trotter step associated with these low rank techniques. To keep this circuit very short for pedagogical purposes we will force a truncation of the eigenvalues <span class="math notranslate nohighlight">\(\lambda_\ell\)</span> at a predetermined value of <code class="docutils literal notranslate"><span class="pre">final_rank</span></code>. While we also support a canned <code class="docutils literal notranslate"><span class="pre">LOW_RANK</span></code> option for the Trotter steps, in order to pass this value of <code class="docutils literal notranslate"><span class="pre">final_rank</span></code> we will instantiate a custom Trotter algorithm type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cirq</span>
<span class="kn">import</span> <span class="nn">openfermion</span>
<span class="kn">from</span> <span class="nn">openfermion.circuits</span> <span class="kn">import</span> <span class="n">trotter</span>

<span class="c1"># Trotter step parameters.</span>
<span class="n">time</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">final_rank</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Initialize circuit qubits in a line.</span>
<span class="n">n_qubits</span> <span class="o">=</span> <span class="n">openfermion</span><span class="o">.</span><span class="n">count_qubits</span><span class="p">(</span><span class="n">molecular_hamiltonian</span><span class="p">)</span>
<span class="n">qubits</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">LineQubit</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>

<span class="c1"># Compile the low rank Trotter step using OpenFermion.</span>
<span class="n">custom_algorithm</span> <span class="o">=</span> <span class="n">trotter</span><span class="o">.</span><span class="n">LowRankTrotterAlgorithm</span><span class="p">(</span><span class="n">final_rank</span><span class="o">=</span><span class="n">final_rank</span><span class="p">)</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Circuit</span><span class="p">(</span>
    <span class="n">trotter</span><span class="o">.</span><span class="n">simulate_trotter</span><span class="p">(</span>
            <span class="n">qubits</span><span class="p">,</span> <span class="n">molecular_hamiltonian</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">omit_final_swaps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="n">custom_algorithm</span><span class="p">),</span>
    <span class="n">strategy</span><span class="o">=</span><span class="n">cirq</span><span class="o">.</span><span class="n">InsertStrategy</span><span class="o">.</span><span class="n">EARLIEST</span><span class="p">)</span>

<span class="c1"># Print circuit.</span>
<span class="n">cirq</span><span class="o">.</span><span class="n">drop_negligible_operations</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">circuit</span><span class="o">.</span><span class="n">to_text_diagram</span><span class="p">(</span><span class="n">transpose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We were able to print out the circuit this way but forcing <code class="docutils literal notranslate"><span class="pre">final_rank</span></code> of 2 is not very accurate. In the cell below, we compile the Trotter step with full rank so <span class="math notranslate nohighlight">\(L = N^2\)</span> and depth is actually <span class="math notranslate nohighlight">\(O(N^3)\)</span> and repeat the Trotter step multiple times to show that it actually converges to the correct result. Since we are not forcing the rank truncation we can use the built-in <code class="docutils literal notranslate"><span class="pre">LOW_RANK</span></code> Trotter step type. Note that the rank of the Coulomb operators is asymptotically <span class="math notranslate nohighlight">\(O(N)\)</span> but for very small molecules in small basis sets only a few eigenvalues can be truncated.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize a random initial state.</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="n">random_seed</span> <span class="o">=</span> <span class="mi">8317</span>
<span class="n">initial_state</span> <span class="o">=</span> <span class="n">openfermion</span><span class="o">.</span><span class="n">haar_random_vector</span><span class="p">(</span>
    <span class="mi">2</span> <span class="o">**</span> <span class="n">n_qubits</span><span class="p">,</span> <span class="n">random_seed</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">complex64</span><span class="p">)</span>

<span class="c1"># Numerically compute the correct circuit output.</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="n">hamiltonian_sparse</span> <span class="o">=</span> <span class="n">openfermion</span><span class="o">.</span><span class="n">get_sparse_operator</span><span class="p">(</span><span class="n">molecular_hamiltonian</span><span class="p">)</span>
<span class="n">exact_state</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">expm_multiply</span><span class="p">(</span>
    <span class="o">-</span><span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">time</span> <span class="o">*</span> <span class="n">hamiltonian_sparse</span><span class="p">,</span> <span class="n">initial_state</span><span class="p">)</span>

<span class="c1"># Trotter step parameters.</span>
<span class="n">n_steps</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c1"># Compile the low rank Trotter step using OpenFermion.</span>
<span class="n">qubits</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">LineQubit</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">n_qubits</span><span class="p">)</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Circuit</span><span class="p">(</span>
    <span class="n">trotter</span><span class="o">.</span><span class="n">simulate_trotter</span><span class="p">(</span>
            <span class="n">qubits</span><span class="p">,</span> <span class="n">molecular_hamiltonian</span><span class="p">,</span>
            <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="n">n_steps</span><span class="p">,</span>
            <span class="n">algorithm</span><span class="o">=</span><span class="n">trotter</span><span class="o">.</span><span class="n">LOW_RANK</span><span class="p">),</span>
    <span class="n">strategy</span><span class="o">=</span><span class="n">cirq</span><span class="o">.</span><span class="n">InsertStrategy</span><span class="o">.</span><span class="n">EARLIEST</span><span class="p">)</span>

<span class="c1"># Use Cirq simulator to apply circuit.</span>
<span class="n">simulator</span> <span class="o">=</span> <span class="n">cirq</span><span class="o">.</span><span class="n">Simulator</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">simulator</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">circuit</span><span class="p">,</span> <span class="n">qubit_order</span><span class="o">=</span><span class="n">qubits</span><span class="p">,</span> <span class="n">initial_state</span><span class="o">=</span><span class="n">initial_state</span><span class="p">)</span>
<span class="n">simulated_state</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">final_state_vector</span>

<span class="c1"># Print final fidelity.</span>
<span class="n">fidelity</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">simulated_state</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">exact_state</span><span class="p">)))</span> <span class="o">**</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fidelity with exact result is </span><span class="si">{}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fidelity</span><span class="p">))</span>

<span class="c1"># Print circuit.</span>
<span class="n">cirq</span><span class="o">.</span><span class="n">drop_negligible_operations</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">circuit</span><span class="o">.</span><span class="n">to_text_diagram</span><span class="p">(</span><span class="n">transpose</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./myenv/openfermion/docs/tutorials"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> 目次
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Copyright 2020 The OpenFermion Developers</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#circuits-3-low-rank-arbitrary-basis-molecular-simulations">Circuits 3: Low rank, arbitrary basis molecular simulations</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#low-rank-decomposition-of-the-coulomb-operator">Low rank decomposition of the Coulomb operator</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example-implementation-trotter-steps-of-lih-in-molecular-orbital-basis">Example implementation: Trotter steps of LiH in molecular orbital basis</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  © Copyright 2025-present by 吉田 聡太 (Sota Yoshida). 本コンテンツは<a rel="license" href="https://creativecommons.org/licenses/by/4.0">CC BY 4.0 ライセンス</a>の下に提供されています。 <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /></a>　ただし、資料中のコードセル部分は<a rel="license" href="https://opensource.org/licenses/MIT">MITライセンス</a>の下に提供されています。

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>